<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.sist.mapper.cart-mapper">
 	<!-- =====================장바구니 담기===================== -->
 	<insert id="productsInCart" parameterType="CartVO">
 	<!-- 
 		CARTNO      NOT NULL NUMBER        
		ID                   VARCHAR2(20)  
		DOMBOOKNO            NUMBER        
		FORBOOKNO            NUMBER        
		USEDBOOKNO           NUMBER        
		VIDEONO              NUMBER        
		QTY                  NUMBER        
		REGDATE              DATE          
		TOTAL_PRICE          NUMBER        
		ADDRESS     NOT NULL VARCHAR2(700) 
		TEL         NOT NULL VARCHAR2(20)  
		EMAIL       NOT NULL VARCHAR2(100) 
		STATE                VARCHAR2(1)   
 	 -->
 		<selectKey keyProperty="cartno" resultType="int" order="BEFORE">
	     SELECT NVL(MAX(cartno)+1,1) as cartno FROM cart
	    </selectKey>
 		INSERT INTO cart VALUES (
		#{cartno},
		#{id},
		#{dombookno, jdbcType=INTEGER},
		#{forbookno, jdbcType=INTEGER},
		#{usedbookno, jdbcType=INTEGER},
		#{videono, jdbcType=INTEGER},
		#{qty},
		SYSDATE,
		#{total_price},
		#{address},
		#{tel},
		#{email},
		'n'
		)
 	</insert>
 	
 	<!-- =====================기존 확인===================== -->
 	<!-- 국내책 -->
 	<select id="dBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND dombookno=#{dombookno}
 	</select>
 	<!-- 동일한 상품 존재하면 수량 수정 -->
 	<update id="updateCartD">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WEHRE id=#{id}
 		AND dombookno = #{dombookno}
 	</update>
 	
 	<!-- 해외책 -->
 	<select id="fBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND forbookno=#{forbookno}
 	</select>
 	
 	<!-- 동일한 상품 존재하면 수정 -->
 	<update id="updateCartF">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WEHRE id=#{id}
 		AND forbookno = #{forbookno}
 	</update>
 	
 	<!-- 클래스 -->
 	<select id="vBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND videono=#{videono}
 	</select>
 	
 	<!-- 동일한 상품 존재하면 수정 -->
 	<update id="updateCartV">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WEHRE id=#{id}
 		AND videono = #{videono}
 	</update>
 	
 	<!-- 중고책 -->
 	<select id="uBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND usedbookno=#{usedbookno}
 	</select>
 	<!-- 동일한 상품 존재하면 수정 -->
 	<update id="updateCartU">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WEHRE id=#{id}
 		AND usedbookno = #{usedbookno}
 	</update>
 	
 	
 	<resultMap type="CartVO" id="CartMap">
 		<result property="cartno" column="cartno"/>
 		<result property="id" column="id"/>
 		<result property="qty" column="qty"/>
 		<result property="regdate" column="regdate"/>
 		<result property="address" column="address"/>
 		<result property="tel" column="tel"/>
 		<result property="email" column="email"/>
 		<result property="state" column="state"/>
 		<result property="total_price" column="total_price"/>
 	</resultMap>
 	
 	<!-- =====================목록===================== -->
 	<select id="dCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno,
	 		d.poster,d.title,d.price,
	 		c.id,
	 		c.qty,
	 		c.address,
	 		c.tel,
			c.email,
			c.state,
			c.regdate,
			c.total_price
 		FROM
 			cart c, book d, member m
 		WHERE d.no = c.dombookno
 			AND m.id=c.id
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	<select id="fCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno,
	 		f.poster,f.title,f.price,
	 		c.id,
	 		c.qty,
	 		c.address,
	 		c.tel,
			c.email,
			c.state,
			c.regdate,
			c.total_price
 		FROM
 			cart c, book_f f, member m
 		WHERE f.no = c.forbookno
 			AND m.id=c.id
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	
 	<select id="uCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno,
	 		u.poster,u.title,u.price,
	 		c.id,
	 		c.qty,
	 		c.address,
	 		c.tel,
			c.email,
			c.state,
			c.regdate,
			c.total_price
 		FROM
 			cart c, book_s u
 		WHERE u.no = c.usedbookno
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	<select id="vCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno,
	 		v.poster,v.title,v.price,
	 		c.id,
	 		c.qty,
	 		c.address,
	 		c.tel,
			c.email,
			c.state,
			c.regdate,
			c.total_price
 		FROM
 			cart c, video v, member m
 		WHERE v.no = c.videono
 			AND m.id=c.id
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	
 	
 	
 	
 	<!-- =====================수정(장바구니 화면에서 상품수량 변경)===================== -->
 	<update id="dModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND dombookno=#{dombookno}
 	</update>
 	
 	<update id="fModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND forbookno=#{forbookno}
 	</update>
 	
 	<update id="uModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND usedbookno=#{usedbookno}
 	</update>
 	
 	<update id="vModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND classno=#{classno}
 	</update>
 	
 	<!-- =====================삭제===================== -->
 	<delete id="DeleteCart">
 		DELETE FROM cart
 		WHERE cartno=#{cartno}
 	</delete>
 	
 	
 </mapper>