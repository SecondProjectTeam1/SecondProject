<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.sist.mapper.cart-mapper">
 	<!-- =====================장바구니 담기===================== -->
 	<insert id="productsInCart" parameterType="CartVO">
 	<!-- 
 		CARTNO      NOT NULL NUMBER        
		ID                   VARCHAR2(20)  
		TYPE                 NUMBER        
		PRODUCTNO            NUMBER        
		QTY                  NUMBER        
		REGDATE              DATE          
		TOTAL_PRICE          NUMBER        
		ADDRESS     NOT NULL VARCHAR2(700) 
		TEL         NOT NULL VARCHAR2(20)  
		EMAIL       NOT NULL VARCHAR2(100) 
		STATE                VARCHAR2(1)    
 	 -->
 		<selectKey keyProperty="cartno" resultType="int" order="BEFORE">
	     SELECT NVL(MAX(cartno)+1,1) as cartno FROM cart
	    </selectKey>
 		INSERT INTO cart VALUES (
		#{cartno},
		#{id},
		#{type},
		#{productno},
		#{qty},
		SYSDATE,
		#{total_price},
		#{address},
		#{tel},
		#{email},
		'n'
		)
 	</insert>
 	
 	
 	<!-- =====================기존 확인===================== -->
 	<!-- 국내책 -->
 	<select id="dBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND type='1'
 	</select>
 	<!-- 동일한 상품 존재하면 수량 수정 -->
 	<update id="updateCartD">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WHERE id=#{id}
 		AND type='1'
 	</update>
 	
 	<!-- 해외책 -->
 	<select id="fBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND type='2'
 	</select>
 	
 	<!-- 동일한 상품 존재하면 수정 -->
 	<update id="updateCartF">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WHERE id=#{id}
 		AND type='2'
 	</update>
 	
 	<!-- 클래스 -->
 	<select id="vBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND type='4'
 	</select>
 	
 	<!-- 동일한 상품 존재하면 수정 -->
 	<update id="updateCartV">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WHERE id=#{id}
 		AND type='4'
 	</update>
 	
 	<!-- 중고책 -->
 	<select id="uBeforeInCart" resultType="int">
 		SELECT COUNT(*)
 		FROM cart
 		WHERE id=#{id}
 		AND type='3'
 	</select>
 	<!-- 동일한 상품 존재하면 수정 -->
 	<update id="updateCartU">
 		UPDATE cart
 		SET qty = qty + #{qty}
 		WHERE id=#{id}
 		AND type='3'
 	</update>
 	
 	<!-- 
 	CARTNO      NOT NULL NUMBER        
	ID                   VARCHAR2(20)  
	TYPE                 NUMBER        
	PRODUCTNO            NUMBER        
	QTY                  NUMBER        
	REGDATE              DATE          
	TOTAL_PRICE          NUMBER        
	ADDRESS     NOT NULL VARCHAR2(700) 
	TEL         NOT NULL VARCHAR2(20)  
	EMAIL       NOT NULL VARCHAR2(100) 
	STATE                VARCHAR2(1)    
 	 -->
 	<resultMap type="CartVO" id="CartMap">
 		<result property="cartno" column="cartno"/>
 		<result property="id" column="id"/>
 		<result property="type" column="type"/>
 		<result property="productno" column="productno"/>
 		<result property="qty" column="qty"/>
 		<result property="regdate" column="regdate"/>
 		<result property="address" column="address"/>
 		<result property="tel" column="tel"/>
 		<result property="email" column="email"/>
 		<result property="state" column="state"/>
 		<result property="total_price" column="total_price"/>
 		<result property="dvo.poster" column="dposter"/>
 		<result property="dvo.title" column="dtitle"/>
 		<result property="dvo.price" column="dprice"/>
 		<result property="fvo.poster" column="fposter"/>
 		<result property="fvo.title" column="ftitle"/>
 		<result property="fvo.price" column="fprice"/>
 		<result property="uvo.poster" column="uposter"/>
 		<result property="uvo.title" column="utitle"/>
 		<result property="uvo.price" column="uprice"/>
 		<result property="cvo.poster" column="cposter"/>
 		<result property="cvo.title" column="ctitle"/>
 		<result property="cvo.price" column="cprice"/>
 	</resultMap>
 	
 	<!-- =====================목록===================== -->
 	<select id="dCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno as cartno,
	 		d.poster as dposter, d.title as dtitle, d.price as dprice,
	 		c.id as id,
	 		c.qty as qty,
			c.total_price as total_price
 		FROM
 			cart c, book d, member m
 		WHERE c.type='1'
 			AND m.id=c.id
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	<select id="fCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno as cartno,
	 		f.poster as fposter, f.title as ftitle, f.price as fprice,
	 		c.id as id,
	 		c.qty as qty,
			c.total_price as total_price
 		FROM
 			cart c, book_f f, member m
 		WHERE c.type='2'
 			AND m.id=c.id
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	
 	<select id="uCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno as cartno,
	 		u.poster as uposter, u.title as utitle, u.price as uprice,
	 		c.id as id,
	 		c.qty as qty,
			c.total_price as total_price
 		FROM
 			cart c, book_s u, member m
 		WHERE c.type='3'
 			AND c.productno=u.no
 			AND m.id=c.id
 			AND c.id=#{id}
 	</select>
 	
 	<select id="vCartList" resultMap="CartMap" parameterType="string">
 		SELECT
	 		c.cartno as cartno,
	 		v.poster as vposter, v.title as vtitle, v.price as vprice,
	 		c.id as id,
	 		c.qty as qty,
			c.total_price as total_price
 		FROM
 			cart c, video v, member m
 		WHERE c.type='4'
 			AND m.id=c.id
 			AND c.id=#{id}
 		ORDER BY
 			c.cartno
 	</select>
 	
 	
 	
 	
 	
 	<!-- =====================수정(장바구니 화면에서 상품수량 변경)===================== -->
 	<update id="dModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND dombookno=#{dombookno}
 	</update>
 	
 	<update id="fModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND forbookno=#{forbookno}
 	</update>
 	
 	<update id="uModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND usedbookno=#{usedbookno}
 	</update>
 	
 	<update id="vModifyCart">
 		UPDATE cart
 		SET qty=#{qty}
 		WHERE id=#{id}
 		AND classno=#{classno}
 	</update>
 	
 	<!-- =====================삭제===================== -->
 	<delete id="DeleteCart">
 		DELETE FROM cart
 		WHERE cartno=#{cartno}
 	</delete>
 	
 	
 </mapper>